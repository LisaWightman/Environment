export CATALINA_HOME=/usr/local/tomcat
export CATALINA_OPTS="-XX:MaxPermSize=160m -Djava.awt.headless=true -ea:com.localmatters... -ea:com.aptas... -Dcom.sun.management.jmxremote.port=1099 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false -Dorg.apache.tomcat.util.buf.UDecoder.ALLOW_ENCODED_SLASH=true -Dorg.apache.catalina.connector.CoyoteAdapter.ALLOW_BACKSLASH=true"

#
#
#
tcpid() {
    local pid=`ps -aux | grep Bootstrap | fgrep -v grep`
    if ! [ -z "$pid" ]; then
        echo $pid | awk '{print $2}'
        return 0
    fi
    return 1
}
tcstop() {
    $CATALINA_HOME/bin/shutdown.sh

    echo -n "Waiting for tomcat to shutdown... "
    i=0
    while tcpid > /dev/null && [ $i -lt 10 ]
    do
        i=$(($i + 1))
        sleep 1;
        echo -n "... "
    done
    echo

    if tcpid > /dev/null
    then
        echo Killing...
        kill -9 `tcpid`
    fi
}
alias tcstart='$CATALINA_HOME/bin/catalina.sh jpda start'
tcrun() {
    if [[ "$1" == "-w" ]]
    then
        rm -rf $CATALINA_HOME/work/* $CATALINA_HOME/temp/*
    fi
    $CATALINA_HOME/bin/catalina.sh jpda run
}
tcwipe() {
    ## echo deleting $CATALINA_HOME/work/* $CATALINA_HOME/webapps/* $CATALINA_HOME/conf/Catalina/
    ## rm -rf $CATALINA_HOME/work/* $CATALINA_HOME/webapps/* $CATALINA_HOME/conf/Catalina/
    ## echo deleting $CATALINA_HOME/work/* $CATALINA_HOME/webapps/*
    for s in $CATALINA_HOME/webapps/*.war; do
        rm -rf $s ${s%%.war}
    done
    rm -rf $CATALINA_HOME/work/* $CATALINA_HOME/temp/*
    if [[ "$1" == "-l" ]]
    then
        echo deleting $CATALINA_HOME/logs/*
        rm $CATALINA_HOME/logs/*
    fi
}
tcclean() {
    tcstop
    tcwipe "$*"
    tcstart
}
